local BolboField = {}
BolboField.__index = BolboField

function BolboField:CreateWindow(text)
    -- Create the main ScreenGui
    local G2L = {}
    G2L["1"] = Instance.new("ScreenGui", game:GetService("Players").LocalPlayer:WaitForChild("PlayerGui"))
    G2L["1"]["Name"] = "BolboHub"
    G2L["1"]["ZIndexBehavior"] = Enum.ZIndexBehavior.Sibling

    -- Window Frame
    G2L["2"] = Instance.new("Frame", G2L["1"])
    G2L["2"]["BorderSizePixel"] = 0
    G2L["2"]["BackgroundColor3"] = Color3.fromRGB(43, 43, 43)
    G2L["2"]["ClipsDescendants"] = true
    G2L["2"]["Size"] = UDim2.new(0, 654, 0, 394)
    G2L["2"]["Position"] = UDim2.new(0.25614, 0, 0.25498, 0)
    G2L["2"]["BorderColor3"] = Color3.fromRGB(0, 0, 0)
    G2L["2"]["Name"] = "Window"
    G2L["2"]["BackgroundTransparency"] = 0.3

    -- Window Stroke
    G2L["3"] = Instance.new("UIStroke", G2L["2"])
    G2L["3"]["Color"] = Color3.fromRGB(117, 117, 117)

    -- Window Label
    G2L["e"] = Instance.new("TextLabel", G2L["2"])
    G2L["e"]["BorderSizePixel"] = 0
    G2L["e"]["TextSize"] = 23
    G2L["e"]["TextXAlignment"] = Enum.TextXAlignment.Left
    G2L["e"]["BackgroundColor3"] = Color3.fromRGB(255, 255, 255)
    G2L["e"]["FontFace"] = Font.new([[rbxasset://fonts/families/SourceSansPro.json]], Enum.FontWeight.Bold, Enum.FontStyle.Normal)
    G2L["e"]["TextColor3"] = Color3.fromRGB(255, 255, 255)
    G2L["e"]["BackgroundTransparency"] = 1
    G2L["e"]["Size"] = UDim2.new(0, 188, 0, 45)
    G2L["e"]["BorderColor3"] = Color3.fromRGB(0, 0, 0)
    G2L["e"]["Text"] = text
    G2L["e"]["Name"] = "WindowLabel"
    G2L["e"]["Position"] = UDim2.new(0.01835, 0, 0, 0)

    -- Destroy Button
    local destroyButton = self:CreateDestroyButton(G2L["2"])
    
    -- Minimalize Button
    local minimalizeButton = self:CreateMinimalizeButton(G2L["2"])
    
    -- Drag Window Functionality
    self:AddDragFunctionality(G2L["2"])

    -- Return the window and the internal table for further customization
    return {
        Window = G2L["2"],
        ScreenGui = G2L["1"],
        InternalTable = G2L
    }
end

function BolboField:CreateDestroyButton(parentFrame)
    local destroyButton = Instance.new("TextButton", parentFrame)
    destroyButton.BorderSizePixel = 0
    destroyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    destroyButton.TextSize = 21
    destroyButton.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    destroyButton.FontFace = Font.new([[rbxasset://fonts/families/FredokaOne.json]], Enum.FontWeight.Regular, Enum.FontStyle.Normal)
    destroyButton.ZIndex = 3
    destroyButton.Size = UDim2.new(0, 53, 0, 46)
    destroyButton.BackgroundTransparency = 1
    destroyButton.Name = "DestroyButton"
    destroyButton.BorderColor3 = Color3.fromRGB(0, 0, 0)
    destroyButton.Text = "X"
    destroyButton.Position = UDim2.new(0.91896, 0, 0, 0)

    -- Destroy functionality
    destroyButton.MouseButton1Click:Connect(function()
        local player = game.Players.LocalPlayer
        local gui = player.PlayerGui:FindFirstChild("BolboHub")
        if gui then
            gui:Destroy()
        end
    end)

    return destroyButton
end

function BolboField:CreateMinimalizeButton(parentFrame)
    local minimalizeButton = Instance.new("TextButton", parentFrame)
    minimalizeButton.BorderSizePixel = 0
    minimalizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    minimalizeButton.TextSize = 55
    minimalizeButton.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    minimalizeButton.FontFace = Font.new([[rbxasset://fonts/families/Zekton.json]], Enum.FontWeight.Regular, Enum.FontStyle.Normal)
    minimalizeButton.ZIndex = 3
    minimalizeButton.Size = UDim2.new(0, 41, 0, 45)
    minimalizeButton.BackgroundTransparency = 1
    minimalizeButton.Name = "MinimalizeButton"
    minimalizeButton.BorderColor3 = Color3.fromRGB(0, 0, 0)
    minimalizeButton.Text = "-"
    minimalizeButton.Position = UDim2.new(0.85627, 0, 0, 0)

    -- Minimalize functionality
    minimalizeButton.MouseButton1Click:Connect(function()
        local player = game.Players.LocalPlayer
        local window = player.PlayerGui:FindFirstChild("BolboHub"):FindFirstChild("Window")
        if window then
            window.Visible = false
        end
    end)

    return minimalizeButton
end

function BolboField:AddDragFunctionality(frame)
    local UserInputService = game:GetService("UserInputService")
    local dragging = false
    local dragStart
    local startPos

    local dragFrame = Instance.new("Frame", frame)
    dragFrame.Name = "DragWindow"
    dragFrame.BackgroundTransparency = 1
    dragFrame.Size = UDim2.new(0, 654, 0, 45)

    local function update(input)
        local delta = input.Position - dragStart
        frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end

    dragFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            update(input)
        end
    end)
end

return BolboField
